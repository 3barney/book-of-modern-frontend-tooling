<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><title>Book of Modern frontend tooling</title><link href="http://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css"><link rel="stylesheet" href="http://getbootstrap.com/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/book-of-modern-frontend-tooling/assets/css/style.css"><base href="/book-of-modern-frontend-tooling/"><script src="http://code.jquery.com/jquery-2.1.0.min.js"></script></head><body><div id="container" class="container-fluid"><div class="row"><div id="sidebar" class="sidebar col-md-3"><div><div class="logo"><a href="https://github.com/tooling/book-of-modern-frontend-tooling">The Front-end Tooling Book</a></div><br><ul>
<li><p><a href="index.html">Introduction</a></p>
</li>
<li><p>Build Systems</p>
<ul>
<li>Modern tools vs shell scripts</li>
<li>Grunt<ul>
<li><a href="build-systems/grunt/getting-started.html">Getting started</a></li>
<li><a href="build-systems/grunt/linter.html">Linting code</a></li>
<li><a href="build-systems/grunt/sass.html">Integrating a CSS preprocessor</a></li>
</ul>
</li>
<li>Brunch<ul>
<li><a href="build-systems/brunch/introduction.html">Introduction</a></li>
<li><a href="build-systems/brunch/getting-started.html">Getting started</a></li>
<li><a href="build-systems/brunch/using-brunch.html">Using Brunch</a></li>
</ul>
</li>
<li>Gulp<ul>
<li><a href="build-systems/gulp/introduction.html">Introduction</a></li>
<li><a href="build-systems/gulp/getting-started.html">Getting started</a></li>
<li><a href="build-systems/gulp/writing-tasks.html">Writing tasks</a></li>
<li><a href="build-systems/gulp/references.html">References</a></li>
</ul>
</li>
</ul>
</li>
<li><p>Dependency management</p>
<ul>
<li>Bower<ul>
<li><a href="dependency-management/bower/introduction.html">Introduction</a></li>
</ul>
</li>
<li>WebPack<ul>
<li><a href="dependency-management/webpack/introduction.html">Introduction</a></li>
<li><a href="dependency-management/webpack/getting-started.html">Getting Started</a></li>
<li><a href="dependency-management/webpack/1-requiring-modules.html">Requiring Modules</a></li>
<li><a href="dependency-management/webpack/2-using-loaders.html">Using Loaders</a></li>
<li><a href="dependency-management/webpack/3-code-splitting.html">Code Splitting</a></li>
<li><a href="dependency-management/webpack/4-multi-entry-builds.html">Muli-entry Builds</a></li>
<li><a href="dependency-management/webpack/5-require-context.html">Require Context</a></li>
<li><a href="dependency-management/webpack/6-hot-module-replacement.html">Hot Module Replacement</a></li>
<li>Chunk Optimization</li>
<li><a href="dependency-management/webpack/8-writing-loaders-and-plugins.html">Writing Loaders And Plugins</a></li>
<li><a href="dependency-management/webpack/9-use-with-build-tools.html">Use With Build Tools</a></li>
<li><a href="dependency-management/webpack/references.html">References</a></li>
<li><a href="dependency-management/webpack/troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li>NPM browserify<ul>
<li><a href="dependency-management/npm-browserify/introduction.html">Introduction</a></li>
<li><a href="dependency-management/npm-browserify/getting-started.html">Getting started</a></li>
<li><a href="dependency-management/npm-browserify/writing-modules.html">Writing Modules</a></li>
<li><a href="dependency-management/npm-browserify/development-workflow.html">Development Workflow</a></li>
</ul>
</li>
</ul>
</li>
<li>Scaffolding<ul>
<li>Yeoman</li>
<li>Brunch</li>
<li>Loom</li>
</ul>
</li>
</ul>
</div></div><div id="content" class="content col-md-9"><h1 id="writing-loaders-plugins">Writing Loaders &amp; Plugins</h1>
<h2 id="creating-a-loader">Creating a Loader</h2>
<p>The loader in webpack is the primary way to transform modules as they are loaded. A loader is a function that gets passed the source of the module:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Transform the source and return it</span>
  <span class="k">return</span> <span class="nx">source</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

</code></pre>
<p>If transforming the source requires an asynchronous operation, use <code>this.callback</code> instead:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Transform the source and use this.callback</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

</code></pre>
<p>This follows the Node.js convention where the first parameter of the callback is an error, or <code>null</code> if there wasn&#39;t an error.</p>
<p>The context of the loader function contains a bunch of useful APIs to enhance your loader. Such as <code>this.cacheable()</code> should generally be set as most module sources can be cached once transformed. This greatly speeds up the compile time upon subsequent bundles:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Only transform this module when it has changed</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">cacheable</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

</code></pre>
<p>A lot of module types are able to include other files or have dependencies. Such as a CSS file is able to <code>@import</code> another or the Jade templating language is able to <code>include</code> another file. It is important to mark the dependencies that each module is able to include. This enables webpack to properly incrementally build and know when to invalidate the cache that module. This is done with the <code>this.addDependency()</code> API:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">// transformer is a completely made up library that transforms our modules</span>
<span class="kd">var</span> <span class="nx">transformer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;transformer&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">cacheable</span><span class="p">();</span>

  <span class="c1">// Transform the source of the module using our made up library</span>
  <span class="kd">var</span> <span class="nx">transformed</span> <span class="o">=</span> <span class="nx">transformer</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>

  <span class="c1">// Our made up library returns the compiled source and dependencies it requires:</span>
  <span class="nx">transformed</span><span class="p">.</span><span class="nx">dependencies</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">dep</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addDependency</span><span class="p">(</span><span class="nx">dep</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">transformed</span><span class="p">.</span><span class="nx">source</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

</code></pre>
<p>Each <em>kind</em> of module and library that converts the syntax into JavaScript will have its own method of compiling the source and determining the dependencies of the source. webpack only exposes a generic API to signify what is a dependency and what is not.</p>
<p>// TODO: Talk about <code>this.resolve()</code> here</p>
<h2 id="creating-a-plugin">Creating a Plugin</h2>
<p>Plugins are useful for extending the way webpack bundles modules.</p>
<p>// TODO: Write this</p>
</div></div><div id="footer" class="center">&copy; 2014 <a href="https://github.com/tooling/book-of-modern-frontend-tooling">The Front-end Tooling Book</a> Authors. Brought to you with love by the <a href='https://github.com/tooling/book-of-modern-frontend-tooling/graphs/contributors'>community</a>. Released under a CC-BY-SA-4.0 license.</div></div><!-- include ./includes/ga.jade--></body></html>